<!-- This HTML file provides a comprehensive Spotify-like UI for the UdioPlayer library. Here's what it includes:

1. **Search and Browse Interface**
   - Search bar for finding tracks by keywords
   - Genre filters for discovering music by category
   - Sorting options (latest, most liked, trending)
   - Random play feature

2. **Player Controls**
   - Play/pause, previous/next track navigation
   - Progress bar with seeking functionality
   - Volume control with mute toggle
   - Loop toggle and section loop controls

3. **Track Display**
   - Grid of track cards with cover art
   - Hover effects for playback controls
   - Track details modal showing additional information
   - Now playing bar with current track info

4. **Advanced Playback Options**
   - Playback speed control
   - Section looping with start/end points and repetition count
   - Track details with full lyrics display

5. **Responsive Design**
   - Works on mobile and desktop screens
   - Properly adjusts layout based on screen size
   - Uses Tailwind CSS for styling

The UI provides access to all the features of the UdioPlayer library in an intuitive way, making it easy for users to discover and play game-appropriate music. -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Udio Player - Game Music Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://dseeker.github.io/udio-player/udio-player.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col">
    <!-- Header/Search Section -->
    <header class="bg-gray-800 p-4 shadow-md">
        <div class="container mx-auto flex flex-col md:flex-row items-center justify-between">
            <div class="flex items-center mb-4 md:mb-0">
                <i class="fas fa-music text-green-500 text-3xl mr-3"></i>
                <h1 class="text-2xl font-bold">Udio Player</h1>
            </div>
            <div class="w-full md:w-1/2">
                <div class="flex items-center bg-gray-700 rounded-full p-2">
                    <input id="search-input" type="text" placeholder="Search tracks, genres, moods..." 
                           class="w-full bg-transparent outline-none px-3 py-1">
                    <button id="search-button" class="bg-green-500 hover:bg-green-600 text-white rounded-full p-2">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Section -->
    <main class="flex-grow container mx-auto p-4">
        <!-- Search Options -->
        <div class="flex flex-wrap mb-4 gap-2">
            <button id="genre-filter-btn" class="bg-gray-800 hover:bg-gray-700 rounded-full px-4 py-1 text-sm">
                Filter by Genre <i class="fas fa-chevron-down ml-1"></i>
            </button>
            <div id="genre-filters" class="hidden absolute mt-10 bg-gray-800 rounded-lg p-2 shadow-lg z-10">
                <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                    <button class="genre-btn px-3 py-1 text-sm rounded hover:bg-gray-700" data-genre="ambient">Ambient</button>
                    <button class="genre-btn px-3 py-1 text-sm rounded hover:bg-gray-700" data-genre="rock">Rock</button>
                    <button class="genre-btn px-3 py-1 text-sm rounded hover:bg-gray-700" data-genre="electronic">Electronic</button>
                    <button class="genre-btn px-3 py-1 text-sm rounded hover:bg-gray-700" data-genre="chillout">Chillout</button>
                    <button class="genre-btn px-3 py-1 text-sm rounded hover:bg-gray-700" data-genre="downtempo">Downtempo</button>
                    <button class="genre-btn px-3 py-1 text-sm rounded hover:bg-gray-700" data-genre="orchestral">Orchestral</button>
                    <button class="genre-btn px-3 py-1 text-sm rounded hover:bg-gray-700" data-genre="cinematic">Cinematic</button>
                    <button class="genre-btn px-3 py-1 text-sm rounded hover:bg-gray-700" data-genre="8-bit">8-bit</button>
                    <button class="genre-btn px-3 py-1 text-sm rounded hover:bg-gray-700" data-genre="lofi">Lo-Fi</button>
                </div>
            </div>
            <button id="sort-results-btn" class="bg-gray-800 hover:bg-gray-700 rounded-full px-4 py-1 text-sm">
                Sort by <span id="current-sort">Latest</span> <i class="fas fa-chevron-down ml-1"></i>
            </button>
            <div id="sort-options" class="hidden absolute mt-10 bg-gray-800 rounded-lg p-2 shadow-lg z-10">
                <button class="sort-option block w-full text-left px-3 py-1 hover:bg-gray-700" data-sort="cache_recent">Latest</button>
                <button class="sort-option block w-full text-left px-3 py-1 hover:bg-gray-700" data-sort="likes">Most Liked</button>
                <button class="sort-option block w-full text-left px-3 py-1 hover:bg-gray-700" data-sort="cache_trending_score">Trending</button>
            </div>
            <button id="random-play-btn" class="bg-green-600 hover:bg-green-700 rounded-full px-4 py-1 text-sm">
                <i class="fas fa-random mr-1"></i> Play Random
            </button>
        </div>

        <!-- Results Status -->
        <div class="flex justify-between items-center mb-4">
            <h2 id="results-title" class="text-xl font-semibold">Discover tracks</h2>
            <span id="results-count" class="text-gray-400"></span>
        </div>

        <!-- Loading Indicator -->
        <div id="loading-indicator" class="hidden flex justify-center items-center py-12">
            <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500"></div>
        </div>

        <!-- Results Grid -->
        <div id="results-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            <!-- Track cards will be inserted here by JavaScript -->
        </div>

        <!-- No Results Message -->
        <div id="no-results" class="hidden text-center py-12">
            <i class="fas fa-search text-gray-600 text-5xl mb-4"></i>
            <p class="text-gray-400 text-lg">No tracks found. Try different search terms.</p>
        </div>
    </main>

    <!-- Now Playing Bar -->
    <footer class="bg-gray-800 border-t border-gray-700 p-4">
        <div class="container mx-auto">
            <div class="flex flex-col md:flex-row items-center">
                <!-- Track Info -->
                <div class="w-full md:w-1/4 flex items-center mb-4 md:mb-0">
                    <img id="now-playing-img" src="https://via.placeholder.com/60" alt="Album Art" 
                         class="h-14 w-14 rounded-md object-cover mr-3">
                    <div>
                        <h3 id="now-playing-title" class="font-medium truncate">Not Playing</h3>
                        <p id="now-playing-artist" class="text-sm text-gray-400">Select a track to play</p>
                    </div>
                </div>
                
                <!-- Player Controls -->
                <div class="w-full md:w-2/4 px-4">
                    <!-- Control Buttons -->
                    <div class="flex justify-center items-center gap-4 mb-2">
                        <button id="loop-toggle" class="text-gray-400 hover:text-white" title="Toggle Loop">
                            <i class="fas fa-redo-alt"></i>
                        </button>
                        <button id="prev-track" class="text-gray-400 hover:text-white" disabled>
                            <i class="fas fa-step-backward"></i>
                        </button>
                        <button id="play-pause" class="bg-white text-black rounded-full h-8 w-8 flex items-center justify-center">
                            <i class="fas fa-play"></i>
                        </button>
                        <button id="next-track" class="text-gray-400 hover:text-white" disabled>
                            <i class="fas fa-step-forward"></i>
                        </button>
                        <button id="loop-section-toggle" class="text-gray-400 hover:text-white" title="Loop Section">
                            <i class="fas fa-exchange-alt"></i>
                        </button>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div class="flex items-center gap-3">
                        <span id="current-time" class="text-xs text-gray-400">0:00</span>
                        <div class="flex-grow relative">
                            <div class="h-1 bg-gray-600 rounded-full">
                                <div id="progress-bar" class="h-1 bg-green-500 rounded-full" style="width: 0%"></div>
                            </div>
                            <input type="range" id="seek-slider" min="0" max="100" value="0" 
                                  class="absolute top-0 left-0 w-full h-1 opacity-0 cursor-pointer">
                        </div>
                        <span id="duration" class="text-xs text-gray-400">0:00</span>
                    </div>
                </div>
                
                <!-- Volume Control -->
                <div class="w-full md:w-1/4 flex justify-end items-center mt-4 md:mt-0">
                    <button id="advanced-toggle" class="text-gray-400 hover:text-white mr-4" title="Advanced Controls">
                        <i class="fas fa-sliders-h"></i>
                    </button>
                    <div class="flex items-center">
                        <button id="volume-toggle" class="text-gray-400 hover:text-white">
                            <i class="fas fa-volume-up"></i>
                        </button>
                        <div class="w-24 ml-2">
                            <input type="range" id="volume-slider" min="0" max="100" value="80" 
                                  class="w-full h-1 bg-gray-600 rounded-full appearance-none">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Advanced Controls Panel -->
    <div id="advanced-panel" class="hidden fixed bottom-24 right-4 bg-gray-800 p-4 rounded-lg shadow-lg w-80 z-20">
        <h3 class="font-medium mb-3">Advanced Controls</h3>
        
        <!-- Playback Rate -->
        <div class="mb-4">
            <label class="block text-sm text-gray-400 mb-1">Playback Speed</label>
            <div class="flex items-center gap-2">
                <input type="range" id="playback-rate-slider" min="50" max="200" value="100" 
                       class="flex-grow h-1 bg-gray-600 rounded-full appearance-none">
                <span id="playback-rate-value" class="text-sm">1x</span>
            </div>
        </div>
        
        <!-- Loop Section -->
        <div class="mb-4">
            <label class="block text-sm text-gray-400 mb-1">Loop Section</label>
            <div class="grid grid-cols-2 gap-2 mb-2">
                <div>
                    <label class="block text-xs text-gray-500">Start (sec)</label>
                    <input type="number" id="loop-start" value="0" min="0" step="1" 
                           class="w-full bg-gray-700 rounded p-1 text-sm">
                </div>
                <div>
                    <label class="block text-xs text-gray-500">End (sec)</label>
                    <input type="number" id="loop-end" value="30" min="1" step="1" 
                           class="w-full bg-gray-700 rounded p-1 text-sm">
                </div>
            </div>
            <div class="grid grid-cols-2 gap-2">
                <div>
                    <label class="block text-xs text-gray-500">Repetitions (0=∞)</label>
                    <input type="number" id="loop-reps" value="0" min="0" step="1" 
                           class="w-full bg-gray-700 rounded p-1 text-sm">
                </div>
                <button id="apply-loop-section" class="bg-green-600 hover:bg-green-700 rounded p-1 text-sm mt-4">
                    Apply Loop
                </button>
            </div>
        </div>
        
        <!-- Additional Controls -->
        <div class="flex justify-between">
            <button id="cancel-loop-section" class="bg-gray-700 hover:bg-gray-600 rounded px-3 py-1 text-sm">
                Cancel Loop
            </button>
            <button id="close-advanced" class="bg-gray-700 hover:bg-gray-600 rounded px-3 py-1 text-sm">
                Close
            </button>
        </div>
    </div>

    <!-- Track Details Modal -->
    <div id="track-details-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-30">
        <div class="bg-gray-800 rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">Track Details</h2>
                <button id="close-modal" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="flex flex-col md:flex-row gap-6">
                <div class="w-full md:w-1/3">
                    <img id="modal-img" src="https://via.placeholder.com/300" alt="Track Cover" 
                         class="w-full aspect-square object-cover rounded-lg">
                </div>
                <div class="w-full md:w-2/3">
                    <h3 id="modal-title" class="font-bold text-lg mb-1">Track Title</h3>
                    <p id="modal-artist" class="text-gray-400 mb-4">Artist Name</p>
                    
                    <div class="mb-4">
                        <h4 class="text-sm font-medium text-gray-300 mb-1">Tags</h4>
                        <div id="modal-tags" class="flex flex-wrap gap-1">
                            <!-- Tags will be inserted here -->
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h4 class="text-sm font-medium text-gray-300 mb-1">Lyrics</h4>
                        <div id="modal-lyrics" class="bg-gray-900 rounded-md p-3 text-sm max-h-48 overflow-y-auto">
                            <!-- Lyrics will be inserted here -->
                        </div>
                    </div>
                    
                    <button id="modal-play" class="bg-green-600 hover:bg-green-700 rounded-full px-6 py-2">
                        <i class="fas fa-play mr-2"></i> Play Track
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Udio Player
            const player = new UdioPlayer({
                useCorsProxy: true
            });
            
            // State variables
            let currentTrack = null;
            let searchResults = [];
            let currentPlaylist = [];
            let currentPlaylistIndex = -1;
            const currentFilters = {
                searchTerm: '',
                genre: null,
                sort: 'cache_recent'
            };
            let isPlaying = false;
            let isLooping = false;
            let isLoopSectionActive = false;
            
            // UI Elements
            const searchInput = document.getElementById('search-input');
            const searchButton = document.getElementById('search-button');
            const resultsGrid = document.getElementById('results-grid');
            const loadingIndicator = document.getElementById('loading-indicator');
            const noResults = document.getElementById('no-results');
            const resultsTitle = document.getElementById('results-title');
            const resultsCount = document.getElementById('results-count');
            
            const nowPlayingImg = document.getElementById('now-playing-img');
            const nowPlayingTitle = document.getElementById('now-playing-title');
            const nowPlayingArtist = document.getElementById('now-playing-artist');
            
            const playPauseButton = document.getElementById('play-pause');
            const prevButton = document.getElementById('prev-track');
            const nextButton = document.getElementById('next-track');
            const loopToggle = document.getElementById('loop-toggle');
            const loopSectionToggle = document.getElementById('loop-section-toggle');
            
            const currentTimeDisplay = document.getElementById('current-time');
            const durationDisplay = document.getElementById('duration');
            const progressBar = document.getElementById('progress-bar');
            const seekSlider = document.getElementById('seek-slider');
            
            const volumeToggle = document.getElementById('volume-toggle');
            const volumeSlider = document.getElementById('volume-slider');
            
            // Filter and sort elements
            const genreFilterBtn = document.getElementById('genre-filter-btn');
            const genreFilters = document.getElementById('genre-filters');
            const genreButtons = document.querySelectorAll('.genre-btn');
            
            const sortResultsBtn = document.getElementById('sort-results-btn');
            const sortOptions = document.getElementById('sort-options');
            const sortOptionButtons = document.querySelectorAll('.sort-option');
            const currentSortDisplay = document.getElementById('current-sort');
            
            const randomPlayBtn = document.getElementById('random-play-btn');
            
            // Advanced panel elements
            const advancedToggle = document.getElementById('advanced-toggle');
            const advancedPanel = document.getElementById('advanced-panel');
            const closeAdvancedButton = document.getElementById('close-advanced');
            
            const playbackRateSlider = document.getElementById('playback-rate-slider');
            const playbackRateValue = document.getElementById('playback-rate-value');
            
            const loopStartInput = document.getElementById('loop-start');
            const loopEndInput = document.getElementById('loop-end');
            const loopRepsInput = document.getElementById('loop-reps');
            const applyLoopSectionButton = document.getElementById('apply-loop-section');
            const cancelLoopSectionButton = document.getElementById('cancel-loop-section');
            
            // Modal elements
            const trackDetailsModal = document.getElementById('track-details-modal');
            const closeModalButton = document.getElementById('close-modal');
            const modalImg = document.getElementById('modal-img');
            const modalTitle = document.getElementById('modal-title');
            const modalArtist = document.getElementById('modal-artist');
            const modalTags = document.getElementById('modal-tags');
            const modalLyrics = document.getElementById('modal-lyrics');
            const modalPlayButton = document.getElementById('modal-play');

            // Helper Functions
            function formatTime(seconds) {
                const minutes = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${minutes}:${secs.toString().padStart(2, '0')}`;
            }
            
            function updateProgressBar() {
                const currentTime = player.getCurrentTime();
                const duration = player.getDuration();
                
                if (duration > 0) {
                    const percentage = (currentTime / duration) * 100;
                    progressBar.style.width = `${percentage}%`;
                    seekSlider.value = percentage;
                    currentTimeDisplay.textContent = formatTime(currentTime);
                    durationDisplay.textContent = formatTime(duration);
                    
                    // Update loop inputs with actual duration
                    if (loopEndInput.value > duration) {
                        loopEndInput.value = Math.floor(duration);
                    }
                    loopEndInput.max = Math.floor(duration);
                }
            }
            
            function updatePlayPauseButton() {
                if (isPlaying) {
                    playPauseButton.innerHTML = '<i class="fas fa-pause"></i>';
                } else {
                    playPauseButton.innerHTML = '<i class="fas fa-play"></i>';
                }
            }
            
            function updateNowPlaying() {
                if (!currentTrack) {
                    nowPlayingTitle.textContent = 'Not Playing';
                    nowPlayingArtist.textContent = 'Select a track to play';
                    nowPlayingImg.src = 'https://via.placeholder.com/60';
                    return;
                }
                
                nowPlayingTitle.textContent = currentTrack.title;
                nowPlayingArtist.textContent = currentTrack.artist;
                
                if (currentTrack.image) {
                    nowPlayingImg.src = currentTrack.image;
                } else {
                    nowPlayingImg.src = 'https://via.placeholder.com/60';
                }
            }
            
            function updateLoopButton() {
                if (isLooping) {
                    loopToggle.classList.add('text-green-500');
                    loopToggle.classList.remove('text-gray-400');
                } else {
                    loopToggle.classList.remove('text-green-500');
                    loopToggle.classList.add('text-gray-400');
                }
            }
            
            function updateLoopSectionButton() {
                if (isLoopSectionActive) {
                    loopSectionToggle.classList.add('text-green-500');
                    loopSectionToggle.classList.remove('text-gray-400');
                } else {
                    loopSectionToggle.classList.remove('text-green-500');
                    loopSectionToggle.classList.add('text-gray-400');
                }
            }
            
            async function playTrack(track) {
                try {
                    loadingIndicator.classList.remove('hidden');
                    
                    await player.play(track);
                    currentTrack = track;
                    isPlaying = true;
                    
                    // Find track in the current playlist if available
                    if (currentPlaylist.length > 0) {
                        currentPlaylistIndex = currentPlaylist.findIndex(t => t.id === track.id);
                        updatePlaylistControls();
                    }
                    
                    updateNowPlaying();
                    updatePlayPauseButton();
                    
                    player.addEventListener('timeupdate', updateProgressBar);
                    player.addEventListener('ended', handleTrackEnd);
                    
                    loadingIndicator.classList.add('hidden');
                } catch (error) {
                    console.error('Error playing track:', error);
                    loadingIndicator.classList.add('hidden');
                    alert('Failed to play track. Please try another one.');
                }
            }
            
            function updatePlaylistControls() {
                if (currentPlaylist.length <= 1) {
                    prevButton.disabled = true;
                    nextButton.disabled = true;
                    return;
                }
                
                prevButton.disabled = currentPlaylistIndex <= 0;
                nextButton.disabled = currentPlaylistIndex >= currentPlaylist.length - 1;
            }
            
            function handleTrackEnd() {
                if (currentPlaylistIndex >= 0 && currentPlaylistIndex < currentPlaylist.length - 1 && currentPlaylist.length > 0) {
                    // Play next track in playlist
                    currentPlaylistIndex++;
                    playTrack(currentPlaylist[currentPlaylistIndex]);
                } else {
                    // End of playlist or no playlist
                    isPlaying = false;
                    updatePlayPauseButton();
                }
            }
            
            function displaySearchResults() {
                resultsGrid.innerHTML = '';
                
                if (searchResults.length === 0) {
                    noResults.classList.remove('hidden');
                    resultsCount.textContent = '0 tracks found';
                    return;
                }
                
                noResults.classList.add('hidden');
                resultsCount.textContent = `${searchResults.length} tracks found`;
                
                currentPlaylist = [...searchResults];
                
                searchResults.forEach((track, index) => {
                    const card = document.createElement('div');
                    card.className = 'bg-gray-800 rounded-lg overflow-hidden hover:bg-gray-700 transition-colors';
                    
                    const imageUrl = track.image || 'https://via.placeholder.com/300/1a202c/ffffff?text=No+Image';
                    
                    card.innerHTML = `
                        <div class="relative group">
                            <img src="${imageUrl}" alt="${track.title}" class="w-full aspect-square object-cover">
                            <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                <button class="play-track-btn bg-green-500 hover:bg-green-600 text-white rounded-full h-12 w-12 flex items-center justify-center" data-index="${index}">
                                    <i class="fas fa-play"></i>
                                </button>
                            </div>
                        </div>
                        <div class="p-3">
                            <h3 class="font-medium truncate" title="${track.title}">${track.title}</h3>
                            <p class="text-sm text-gray-400">${track.artist}</p>
                            <div class="flex justify-between items-center mt-2">
                                <span class="text-xs text-gray-500">${formatTime(track.duration || 0)}</span>
                                <button class="view-details-btn text-gray-400 hover:text-white" data-index="${index}">
                                    <i class="fas fa-info-circle"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    
                    resultsGrid.appendChild(card);
                });
                
                // Add event listeners to play buttons
                document.querySelectorAll('.play-track-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const index = parseInt(e.currentTarget.dataset.index);
                        playTrack(searchResults[index]);
                    });
                });
                
                // Add event listeners to view details buttons
                document.querySelectorAll('.view-details-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const index = parseInt(e.currentTarget.dataset.index);
                        showTrackDetails(searchResults[index]);
                    });
                });
            }
            
            function showTrackDetails(track) {
                modalTitle.textContent = track.title;
                modalArtist.textContent = track.artist;
                
                if (track.image) {
                    modalImg.src = track.image;
                } else {
                    modalImg.src = 'https://via.placeholder.com/300/1a202c/ffffff?text=No+Image';
                }
                
                // Display tags
                modalTags.innerHTML = '';
                if (track.tags && track.tags.length) {
                    track.tags.forEach(tag => {
                        const tagEl = document.createElement('span');
                        tagEl.className = 'bg-gray-700 text-xs px-2 py-1 rounded-full';
                        tagEl.textContent = tag;
                        modalTags.appendChild(tagEl);
                    });
                } else {
                    modalTags.innerHTML = '<span class="text-gray-500">No tags available</span>';
                }
                
                // Display lyrics
                if (track.lyrics) {
                    modalLyrics.textContent = track.lyrics;
                } else {
                    modalLyrics.textContent = 'No lyrics available';
                }
                
                // Set up play button
                modalPlayButton.onclick = () => {
                    playTrack(track);
                    trackDetailsModal.classList.add('hidden');
                };
                
                // Show modal
                trackDetailsModal.classList.remove('hidden');
            }
            
            async function performSearch() {
                const searchTerm = searchInput.value.trim();
                currentFilters.searchTerm = searchTerm;
                
                if (!searchTerm && !currentFilters.genre) {
                    return;
                }
                
                try {
                    loadingIndicator.classList.remove('hidden');
                    resultsGrid.innerHTML = '';
                    noResults.classList.add('hidden');
                    
                    const searchOptions = {
                        maxResults: 20,
                        sort: currentFilters.sort
                    };
                    
                    if (searchTerm) {
                        searchOptions.searchTerm = searchTerm;
                        resultsTitle.textContent = `Results for "${searchTerm}"`;
                    } else if (currentFilters.genre) {
                        searchOptions.tags = [currentFilters.genre];
                        resultsTitle.textContent = `${currentFilters.genre} tracks`;
                    }
                    
                    searchResults = await player.search(searchOptions);
                    displaySearchResults();
                } catch (error) {
                    console.error('Search error:', error);
                    noResults.classList.remove('hidden');
                    resultsCount.textContent = 'Search failed';
                } finally {
                    loadingIndicator.classList.add('hidden');
                }
            }
            
            // Event Listeners
            searchButton.addEventListener('click', performSearch);
            searchInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });
            
            // Play/Pause button
            playPauseButton.addEventListener('click', () => {
                if (!currentTrack) return;
                
                if (isPlaying) {
                    player.pause();
                    isPlaying = false;
                } else {
                    player.resume();
                    isPlaying = true;
                }
                
                updatePlayPauseButton();
            });
            
            // Loop toggle
            loopToggle.addEventListener('click', () => {
                isLooping = !isLooping;
                player.setLoop(isLooping);
                
                if (isLooping && isLoopSectionActive) {
                    isLoopSectionActive = false;
                    player.cancelLoopSection();
                    updateLoopSectionButton();
                }
                
                updateLoopButton();
            });
            
            // Loop section toggle
            loopSectionToggle.addEventListener('click', () => {
                advancedPanel.classList.remove('hidden');
            });
            
            // Previous track
            prevButton.addEventListener('click', () => {
                if (currentPlaylistIndex > 0 && currentPlaylist.length > 0) {
                    currentPlaylistIndex--;
                    playTrack(currentPlaylist[currentPlaylistIndex]);
                }
            });
            
            // Next track
            nextButton.addEventListener('click', () => {
                if (currentPlaylistIndex < currentPlaylist.length - 1 && currentPlaylist.length > 0) {
                    currentPlaylistIndex++;
                    playTrack(currentPlaylist[currentPlaylistIndex]);
                }
            });
            
            // Seek functionality
            seekSlider.addEventListener('input', (e) => {
                const seekValue = e.target.value;
                if (player.getDuration() > 0) {
                    const seekTime = (seekValue / 100) * player.getDuration();
                    progressBar.style.width = `${seekValue}%`;
                    currentTimeDisplay.textContent = formatTime(seekTime);
                }
            });
            
            seekSlider.addEventListener('change', (e) => {
                const seekValue = e.target.value;
                if (player.getDuration() > 0) {
                    const seekTime = (seekValue / 100) * player.getDuration();
                    player.seek(seekTime);
                }
            });
            
            // Volume control
            volumeSlider.addEventListener('input', (e) => {
                const volumeValue = e.target.value / 100;
                player.setVolume(volumeValue);
                
                // Update volume icon
                if (volumeValue === 0) {
                    volumeToggle.innerHTML = '<i class="fas fa-volume-mute"></i>';
                } else if (volumeValue < 0.5) {
                    volumeToggle.innerHTML = '<i class="fas fa-volume-down"></i>';
                } else {
                    volumeToggle.innerHTML = '<i class="fas fa-volume-up"></i>';
                }
            });
            
            volumeToggle.addEventListener('click', () => {
                if (player.getVolume() > 0) {
                    // Store the current volume and mute
                    volumeToggle.dataset.previousVolume = volumeSlider.value;
                    volumeSlider.value = 0;
                    player.setVolume(0);
                    volumeToggle.innerHTML = '<i class="fas fa-volume-mute"></i>';
                } else {
                    // Restore previous volume
                    const previousVolume = volumeToggle.dataset.previousVolume || 80;
                    volumeSlider.value = previousVolume;
                    player.setVolume(previousVolume / 100);
                    volumeToggle.innerHTML = '<i class="fas fa-volume-up"></i>';
                }
            });
            
            // Genre filter button
            genreFilterBtn.addEventListener('click', () => {
                genreFilters.classList.toggle('hidden');
                sortOptions.classList.add('hidden'); // Hide sort options if open
            });
            
            // Genre buttons
            genreButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const genre = button.dataset.genre;
                    currentFilters.genre = genre;
                    genreFilterBtn.textContent = `Genre: ${genre}`;
                    genreFilters.classList.add('hidden');
                    performSearch();
                });
            });
            
            // Sort results button
            sortResultsBtn.addEventListener('click', () => {
                sortOptions.classList.toggle('hidden');
                genreFilters.classList.add('hidden'); // Hide genre filters if open
            });
            
            // Sort option buttons
            sortOptionButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const sortMethod = button.dataset.sort;
                    currentFilters.sort = sortMethod;
                    const sortName = button.textContent;
                    currentSortDisplay.textContent = sortName;
                    sortOptions.classList.add('hidden');
                    performSearch();
                });
            });
            
            // Random play button
            randomPlayBtn.addEventListener('click', async () => {
                try {
                    let genre = currentFilters.genre || 'ambient';
                    
                    loadingIndicator.classList.remove('hidden');
                    await player.playRandomByGenre(genre, { volume: volumeSlider.value / 100 });
                    
                    currentTrack = player.getCurrentTrack();
                    isPlaying = true;
                    
                    updateNowPlaying();
                    updatePlayPauseButton();
                    
                    player.addEventListener('timeupdate', updateProgressBar);
                    player.addEventListener('ended', handleTrackEnd);
                    
                    loadingIndicator.classList.add('hidden');
                } catch (error) {
                    console.error('Error playing random track:', error);
                    loadingIndicator.classList.add('hidden');
                    alert('Failed to play random track. Please try again.');
                }
            });
            
            // Advanced panel toggle
            advancedToggle.addEventListener('click', () => {
                advancedPanel.classList.toggle('hidden');
            });
            
            closeAdvancedButton.addEventListener('click', () => {
                advancedPanel.classList.add('hidden');
            });
            
            // Playback rate slider
            playbackRateSlider.addEventListener('input', (e) => {
                const rate = e.target.value / 100;
                player.setPlaybackRate(rate);
                playbackRateValue.textContent = `${rate.toFixed(2)}x`;
            });
            
            // Loop section controls
            applyLoopSectionButton.addEventListener('click', () => {
                if (!currentTrack) return;
                
                const startTime = parseFloat(loopStartInput.value);
                const endTime = parseFloat(loopEndInput.value);
                const repetitions = parseInt(loopRepsInput.value);
                
                if (startTime >= endTime || endTime > player.getDuration()) {
                    alert('Invalid loop section. Please check your values.');
                    return;
                }
                
                player.loopSection({
                    startTime: startTime,
                    endTime: endTime,
                    repetitions: repetitions > 0 ? repetitions : undefined
                });
                
                isLoopSectionActive = true;
                isLooping = false;
                updateLoopSectionButton();
                updateLoopButton();
                advancedPanel.classList.add('hidden');
            });
            
            cancelLoopSectionButton.addEventListener('click', () => {
                player.cancelLoopSection();
                isLoopSectionActive = false;
                updateLoopSectionButton();
            });
            
            // Modal close button
            closeModalButton.addEventListener('click', () => {
                trackDetailsModal.classList.add('hidden');
            });
            
            // Close modal when clicking outside
            trackDetailsModal.addEventListener('click', (e) => {
                if (e.target === trackDetailsModal) {
                    trackDetailsModal.classList.add('hidden');
                }
            });
            
            // Initialize with some popular tracks
            async function loadInitialTracks() {
                try {
                    loadingIndicator.classList.remove('hidden');
                    resultsTitle.textContent = 'Popular Tracks';
                    
                    searchResults = await player.search({
                        maxResults: 20,
                        sort: 'cache_trending_score'
                    });
                    
                    displaySearchResults();
                } catch (error) {
                    console.error('Error loading initial tracks:', error);
                    noResults.classList.remove('hidden');
                    resultsCount.textContent = 'Failed to load tracks';
                } finally {
                    loadingIndicator.classList.add('hidden');
                }
            }
            
            // Set default volume
            player.setVolume(volumeSlider.value / 100);
            
            // Load initial content
            loadInitialTracks();
            
            // Close dropdowns when clicking elsewhere
            document.addEventListener('click', (e) => {
                if (!e.target.closest('#genre-filter-btn') && !e.target.closest('#genre-filters')) {
                    genreFilters.classList.add('hidden');
                }
                
                if (!e.target.closest('#sort-results-btn') && !e.target.closest('#sort-options')) {
                    sortOptions.classList.add('hidden');
                }
            });
        });
    </script>
</body>
</html>
